<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - ShaharTaxi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #00c6ff, #007bff);
      margin: 0; padding: 0;
      color: #333;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; margin-bottom: 1rem; }
    .filters { text-align: center; margin-bottom: 1.5rem; }
    .filters button {
      margin: 0 5px; padding: 8px 16px;
      border: none; border-radius: 8px;
      background: #007bff; color: white;
      cursor: pointer; font-weight: 600;
    }
    .filters button.active { background: #0056b3; }
    .ad-card {
      background: #f9f9f9;
      padding: 1rem; border-radius: 12px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .ad-actions button {
      margin-right: 8px; padding: 6px 12px;
      border: none; border-radius: 6px; cursor: pointer;
    }
    .approve { background: #28a745; color: white; }
    .reject { background: #dc3545; color: white; }
    .edit { background: #ffc107; }
    .delete { background: #6c757d; color: white; }
  </style>
</head>
<body>
  <main>
    <h2>üõ† Admin Panel - ShaharTaxi</h2>
    
    <div class="filters">
      <button class="active" onclick="filterAds('all')">Barchasi</button>
      <button onclick="filterAds('pending')">Kutilayotgan</button>
      <button onclick="filterAds('approved')">Tasdiqlangan</button>
      <button onclick="filterAds('rejected')">Rad etilgan</button>
    </div>

    <div id="adsContainer"></div>
  </main>

  <script>
    let allAds = [];
    let currentFilter = 'all';

    function loadAds() {
      const drivers = JSON.parse(localStorage.getItem('driverAds')) || [];
      const passengers = JSON.parse(localStorage.getItem('passengerAds')) || [];
      allAds = [...drivers.map(d => ({...d, type: 'driver'})), ...passengers.map(p => ({...p, type: 'passenger'}))];
      renderAds();
      updateStats();
    }

    function renderAds() {
      const container = document.getElementById('adsContainer');
      container.innerHTML = '';
      const filtered = allAds.filter(ad => 
        currentFilter === 'all' ? true : (ad.status || 'pending') === currentFilter
      );
      
      if (filtered.length === 0) {
        container.innerHTML = "<p style='text-align:center;color:gray;'>E‚Äôlonlar yo‚Äòq</p>";
        return;
      }

      filtered.forEach((ad, index) => {
        const div = document.createElement('div');
        div.className = 'ad-card';
        div.innerHTML = `
          <strong>${ad.fromRegion || ''} ‚Üí ${ad.toRegion || ''}</strong><br>
          üìç ${ad.fromDistrict || ''} - ${ad.toDistrict || ''}<br>
          ‚òéÔ∏è ${ad.phone || '-'}<br>
          üí∞ ${ad.price || '-'} so‚Äòm<br>
          <div class="ad-actions">
            <button class="approve" onclick="approveAd(${index})">Tasdiqlash</button>
            <button class="reject" onclick="rejectAd(${index})">Rad etish</button>
            <button class="edit" onclick="editAd(${index})">Tahrirlash</button>
            <button class="delete" onclick="deleteAd(${index})">O‚Äòchirish</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function approveAd(index) {
      allAds[index].status = 'approved';
      saveAllAds();
    }

    function rejectAd(index) {
      allAds[index].status = 'rejected';
      saveAllAds();
    }

    function editAd(index) {
      const ad = allAds[index];
      const newPhone = prompt("Telefon raqamni tahrirlang:", ad.phone);
      const newPrice = prompt("Narxni tahrirlang:", ad.price);
      if (newPhone) ad.phone = newPhone;
      if (newPrice) ad.price = newPrice;
      saveAllAds();
    }

    function deleteAd(index) {
      if (confirm("Bu e‚Äôloni o‚Äòchirmoqchimisiz?")) {
        allAds.splice(index, 1);
        saveAllAds();
      }
    }

    function saveAllAds() {
      const drivers = allAds.filter(ad => ad.type === 'driver');
      const passengers = allAds.filter(ad => ad.type === 'passenger');
      localStorage.setItem('driverAds', JSON.stringify(drivers));
      localStorage.setItem('passengerAds', JSON.stringify(passengers));
      renderAds();
      updateStats();
    }

    function filterAds(type) {
      currentFilter = type;
      document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderAds();
    }

    function updateStats() {
      const approved = allAds.filter(ad => ad.status === 'approved').length;
      const rejected = allAds.filter(ad => ad.status === 'rejected').length;
      const pending = allAds.filter(ad => !ad.status || ad.status === 'pending').length;

      const stats = { approved, rejected, pending, total: allAds.length, updatedAt: new Date().toISOString() };
      localStorage.setItem('adminStats', JSON.stringify(stats));
    }

    setInterval(loadAds, 5000);
    loadAds();
  </script>
</body>
</html>
