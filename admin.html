<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin panel - ShaharTaxi</title>
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header {
      background: #007bff; color: white; padding: 1rem; text-align: center;
      display: flex; justify-content: space-between; align-items: center;
    }
    header button {
      background: #fff; border: none; color: #007bff; padding: 0.5rem 1rem;
      border-radius: 8px; cursor: pointer;
    }
    h2 { text-align: center; color: #007bff; }
    section { padding: 1rem; max-width: 800px; margin: auto; }
    .ad {
      background: white; margin: 1rem 0; padding: 1rem; border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .actions button {
      margin-right: 0.5rem; border: none; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer;
    }
    .approve { background: #28a745; color: white; }
    .reject { background: #dc3545; color: white; }
    .edit { background: #ffc107; color: #333; }
  </style>
</head>
<body>
  <header>
    <h1>üõ† Admin panel</h1>
    <button onclick="logout()">Chiqish</button>
  </header>

  <section>
    <h2>üöó Haydovchi e‚Äôlonlari</h2>
    <div id="driverAds"></div>

    <h2>üßç Yo‚Äòlovchi e‚Äôlonlari</h2>
    <div id="passengerAds"></div>
  </section>

  <script>
    if (localStorage.getItem("adminLoggedIn") !== "true") {
      window.location.href = "admin-login.html";
    }

    function loadAds() {
      const driverAds = JSON.parse(localStorage.getItem('driverAds')) || [];
      const passengerAds = JSON.parse(localStorage.getItem('passengerAds')) || [];

      document.getElementById('driverAds').innerHTML = driverAds.map((ad, i) => `
        <div class="ad">
          <b>${ad.fromRegion}, ${ad.fromDistrict}</b> ‚Üí <b>${ad.toRegion}, ${ad.toDistrict}</b><br>
          Haydovchi: ${ad.driver} | üìû ${ad.phone} | üí∞ ${ad.price} so‚Äòm
          <div class="actions">
            <button class="approve" onclick="approveAd('driver', ${i})">Tasdiqlash</button>
            <button class="reject" onclick="rejectAd('driver', ${i})">Rad etish</button>
            <button class="edit" onclick="editAd('driver', ${i})">Tahrirlash</button>
          </div>
        </div>
      `).join('');

      document.getElementById('passengerAds').innerHTML = passengerAds.map((ad, i) => `
        <div class="ad">
          <b>${ad.fromRegion}, ${ad.fromDistrict}</b> ‚Üí <b>${ad.toRegion}, ${ad.toDistrict}</b><br>
          Yo‚Äòlovchi: üìû ${ad.phone} | üí∞ ${ad.price} so‚Äòm
          <div class="actions">
            <button class="approve" onclick="approveAd('passenger', ${i})">Tasdiqlash</button>
            <button class="reject" onclick="rejectAd('passenger', ${i})">Rad etish</button>
            <button class="edit" onclick="editAd('passenger', ${i})">Tahrirlash</button>
          </div>
        </div>
      `).join('');
    }

    function approveAd(type, index) {
      const key = type + 'Ads';
      const ads = JSON.parse(localStorage.getItem(key)) || [];
      const ad = ads.splice(index, 1)[0];
      const approved = JSON.parse(localStorage.getItem('approvedAds')) || [];
      approved.push({ ...ad, type });
      localStorage.setItem('approvedAds', JSON.stringify(approved));
      localStorage.setItem(key, JSON.stringify(ads));
      updateStats('approved');
      loadAds();
    }

    function rejectAd(type, index) {
      const key = type + 'Ads';
      const ads = JSON.parse(localStorage.getItem(key)) || [];
      ads.splice(index, 1);
      localStorage.setItem(key, JSON.stringify(ads));
      updateStats('rejected');
      loadAds();
    }

    function editAd(type, index) {
      const key = type + 'Ads';
      const ads = JSON.parse(localStorage.getItem(key)) || [];
      const ad = ads[index];
      const newPrice = prompt("Yangi narxni kiriting:", ad.price);
      const newPhone = prompt("Yangi telefon raqam:", ad.phone);
      if (newPrice && newPhone) {
        ad.price = newPrice;
        ad.phone = newPhone;
        ads[index] = ad;
        localStorage.setItem(key, JSON.stringify(ads));
        loadAds();
      }
    }

    function updateStats(action) {
      const stats = JSON.parse(localStorage.getItem('adminStats')) || { approved: 0, rejected: 0 };
      stats[action]++;
      localStorage.setItem('adminStats', JSON.stringify(stats));
    }

    function logout() {
      localStorage.removeItem("adminLoggedIn");
      window.location.href = "admin-login.html";
    }

    setInterval(loadAds, 5000);
    loadAds();
  </script>
</body>
</html>
