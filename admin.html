<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin panel - ShaharTaxi</title>
<style>
  body { font-family: Arial, sans-serif; background:#f7f9fc; margin:0; padding:0; }
  header { background:#007bff; color:white; text-align:center; padding:15px; }
  .container { max-width:1000px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  h2 { text-align:center; color:#007bff; }
  .ad-box { border:1px solid #ddd; border-radius:8px; padding:12px; margin:8px 0; }
  .pending { background:#fff8e1; }
  .approved { background:#e6ffe6; }
  .rejected { background:#ffe6e6; }
  .actions button { padding:6px 10px; border:none; border-radius:5px; cursor:pointer; margin-right:5px; color:white; }
  .approve { background:#28a745; }
  .reject { background:#dc3545; }
  .filters { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:8px; margin-bottom:15px; }
  select, button { padding:8px; font-size:14px; }
  .logout { position:absolute; top:15px; right:20px; background:#dc3545; color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <h1>ShaharTaxi - Admin panel</h1>
  <button class="logout" onclick="logout()">Chiqish</button>
</header>

<div class="container">
  <h2>Barcha e‚Äôlonlar</h2>

  <div class="filters">
    <select id="typeFilter" onchange="renderAds()">
      <option value="all">Barcha turlar</option>
      <option value="driver">Haydovchi</option>
      <option value="passenger">Yo‚Äòlovchi</option>
    </select>
    <select id="statusFilter" onchange="renderAds()">
      <option value="all">Barcha holatlar</option>
      <option value="pending">Kutilmoqda</option>
      <option value="approved">Tasdiqlangan</option>
      <option value="rejected">Rad etilgan</option>
    </select>
    <button onclick="clearFilters()">Filterlarni tozalash</button>
  </div>

  <div id="adsList"></div>
</div>

<script>
function logout(){
  localStorage.removeItem('isAdmin');
  window.location.href='login.html';
}

function getAds(){
  return {
    driver: JSON.parse(localStorage.getItem('driverAds')) || [],
    passenger: JSON.parse(localStorage.getItem('passengerAds')) || []
  };
}

function saveAds(type, data){
  localStorage.setItem(type==='driver'?'driverAds':'passengerAds', JSON.stringify(data));
}

function renderAds(){
  const { driver, passenger } = getAds();
  let allAds = [...driver, ...passenger];
  
  const typeFilter = document.getElementById('typeFilter').value;
  const statusFilter = document.getElementById('statusFilter').value;

  if(typeFilter !== 'all') allAds = allAds.filter(a => a.type === typeFilter);
  if(statusFilter !== 'all') allAds = allAds.filter(a => (a.status || 'pending') === statusFilter);

  const container = document.getElementById('adsList');
  container.innerHTML = allAds.length ? "" : "<p>Hozircha e‚Äôlonlar yo‚Äòq.</p>";

  allAds.sort((a,b)=>b.createdAt?.localeCompare(a.createdAt || ""));

  allAds.forEach(ad => {
    const div = document.createElement('div');
    div.className = `ad-box ${ad.status || 'pending'}`;

    const statusText = ad.status === 'approved'
      ? '‚úÖ Tasdiqlangan'
      : ad.status === 'rejected'
      ? '‚ùå Rad etilgan'
      : '‚è≥ Kutilmoqda';

    div.innerHTML = `
      <p><b>Tur:</b> ${ad.type === 'driver' ? 'Haydovchi' : 'Yo‚Äòlovchi'}</p>
      <p><b>Yo‚Äònalish:</b> ${ad.fromRegion || ''} ${ad.fromDistrict || ''} ‚Üí ${ad.toRegion || ''} ${ad.toDistrict || ''}</p>
      <p><b>Narx:</b> ${ad.price || 'Ko‚Äòrsatilmagan'} so‚Äòm</p>
      <p><b>Telefon:</b> ${ad.phone}</p>
      ${ad.comment ? `<p><b>Izoh:</b> ${ad.comment}</p>` : ''}
      <p><b>Holat:</b> ${statusText}</p>
      ${ad.createdAt ? `<small style="color:#666;">üïí ${ad.createdAt}</small>` : ''}
      <div class="actions">
        <button class="approve" onclick="updateStatus('${ad.id}', '${ad.type}', 'approved')">Tasdiqlash</button>
        <button class="reject" onclick="updateStatus('${ad.id}', '${ad.type}', 'rejected')">Rad etish</button>
      </div>
    `;
    container.appendChild(div);
  });
}

function updateStatus(id, type, status){
  const key = type==='driver' ? 'driverAds' : 'passengerAds';
  const ads = JSON.parse(localStorage.getItem(key)) || [];
  const ad = ads.find(a => a.id === id);
  if(!ad) return;
  ad.status = status;
  saveAds(type, ads);
  renderAds();
}

function clearFilters(){
  document.getElementById('typeFilter').value='all';
  document.getElementById('statusFilter').value='all';
  renderAds();
}

window.onload = () => {
  const isAdmin = localStorage.getItem('isAdmin');
  if(!isAdmin){ alert("Avval admin sifatida tizimga kiring!"); window.location.href='login.html'; return; }
  renderAds();
  setInterval(renderAds, 5000);
};
</script>

</body>
</html>
