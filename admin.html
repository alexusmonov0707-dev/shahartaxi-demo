<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin panel - ShaharTaxi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#007bff,#00c6ff);margin:0;padding:0;color:#333}
    header{background:white;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
    header h1{margin:0;color:#007bff}
    main{max-width:900px;margin:2rem auto;background:#fff;border-radius:16px;padding:2rem;box-shadow:0 6px 20px rgba(0,0,0,0.1)}
    h2{color:#007bff;text-align:center}
    .ad-list{margin-top:1.5rem;display:grid;gap:1rem}
    .ad-item{border:1px solid #ddd;border-radius:12px;padding:1rem;background:#f9f9f9}
    .actions{margin-top:1rem;display:flex;gap:.5rem}
    button{padding:.5rem 1rem;border:none;border-radius:8px;cursor:pointer;color:white}
    .approve{background:#28a745}.reject{background:#dc3545}.edit{background:#ffc107;color:#222}
  </style>
</head>
<body>
  <header>
    <h1>üõ† ShaharTaxi Admin Panel</h1>
    <button onclick="logout()" style="background:#ff5252;color:#fff;padding:.5rem 1rem;border:none;border-radius:8px;">Chiqish</button>
  </header>

  <main>
    <h2>üöó Haydovchi e‚Äôlonlari</h2>
    <div id="driverList" class="ad-list"></div>
    <h2>üßç Yo‚Äòlovchi e‚Äôlonlari</h2>
    <div id="passengerList" class="ad-list"></div>
  </main>

  <script>
    // faqat admin kira oladi
    if(localStorage.getItem("isAdmin")!=="true"){window.location.href="admin-login.html";}
    function logout(){localStorage.removeItem("isAdmin");window.location.href="admin-login.html";}

    function loadAds(){
      const dAds=JSON.parse(localStorage.getItem("driverAds"))||[];
      const pAds=JSON.parse(localStorage.getItem("passengerAds"))||[];
      const dList=document.getElementById("driverList");
      const pList=document.getElementById("passengerList");
      dList.innerHTML="";pList.innerHTML="";
      dAds.forEach((ad,i)=>{
        const div=document.createElement("div");
        div.className="ad-item";
        div.innerHTML=`<strong>${ad.fromRegion} (${ad.fromDistrict}) ‚Üí ${ad.toRegion} (${ad.toDistrict})</strong><br>
        Haydovchi: ${ad.driver}<br>Tel: ${ad.phone}<br>Narx: ${ad.price} so‚Äòm
        <div class="actions">
          <button class="approve" onclick="approveAd('driver',${i})">Tasdiqlash</button>
          <button class="reject" onclick="rejectAd('driver',${i})">Rad etish</button>
          <button class="edit" onclick="editAd('driver',${i})">Tahrirlash</button>
        </div>`;
        dList.appendChild(div);
      });
      pAds.forEach((ad,i)=>{
        const div=document.createElement("div");
        div.className="ad-item";
        div.innerHTML=`<strong>${ad.fromRegion} (${ad.fromDistrict}) ‚Üí ${ad.toRegion} (${ad.toDistrict})</strong><br>
        Tel: ${ad.phone}<br>Taklif narxi: ${ad.price} so‚Äòm
        <div class="actions">
          <button class="approve" onclick="approveAd('passenger',${i})">Tasdiqlash</button>
          <button class="reject" onclick="rejectAd('passenger',${i})">Rad etish</button>
          <button class="edit" onclick="editAd('passenger',${i})">Tahrirlash</button>
        </div>`;
        pList.appendChild(div);
      });
    }

    function approveAd(type,index){
      const ads=JSON.parse(localStorage.getItem(type+"Ads"))||[];
      const approved=JSON.parse(localStorage.getItem("approvedAds"))||[];
      approved.push({...ads[index],type});
      localStorage.setItem("approvedAds",JSON.stringify(approved));
      ads.splice(index,1);
      localStorage.setItem(type+"Ads",JSON.stringify(ads));
      updateStats();loadAds();
    }

    function rejectAd(type,index){
      const ads=JSON.parse(localStorage.getItem(type+"Ads"))||[];
      ads.splice(index,1);
      localStorage.setItem(type+"Ads",JSON.stringify(ads));
      loadAds();
    }

    function editAd(type,index){
      const ads=JSON.parse(localStorage.getItem(type+"Ads"))||[];
      const ad=ads[index];
      const newPrice=prompt("Yangi narx:",ad.price);
      const newPhone=prompt("Yangi telefon raqam:",ad.phone);
      if(newPrice!==null)ad.price=newPrice;
      if(newPhone!==null)ad.phone=newPhone;
      localStorage.setItem(type+"Ads",JSON.stringify(ads));
      loadAds();
    }

    function updateStats(){
      const approved=JSON.parse(localStorage.getItem("approvedAds"))||[];
      const d=approved.filter(a=>a.type==="driver").length;
      const p=approved.filter(a=>a.type==="passenger").length;
      const stats={drivers:d,passengers:p,updatedAt:new Date().toLocaleString()};
      localStorage.setItem("stats",JSON.stringify(stats));
    }

    setInterval(loadAds,5000);
    loadAds();
  </script>
</body>
</html>
